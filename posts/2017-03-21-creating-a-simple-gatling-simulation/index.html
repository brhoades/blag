<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>Creating a Gatling Simulation</title>
		<meta name="description" content="Safe space for semicoherent ramblings.">
		<link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Billy Rhoades&#39; Blog">
		<link rel="alternate" href="/feed/feed.json" type="application/json" title="Billy Rhoades&#39; Blog">
		
		<style>/* Only include the syntax highlighter CSS on blog posts */
/**
 * okaidia theme for JavaScript, CSS and HTML
 * Loosely based on Monokai textmate theme by http://www.monokai.nl/
 * @author ocodia
 */

code[class*="language-"],
pre[class*="language-"] {
	color: #f8f8f2;
	background: none;
	text-shadow: 0 1px rgba(0, 0, 0, 0.3);
	font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace;
	font-size: 1em;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
	word-wrap: normal;
	line-height: 1.5;

	-moz-tab-size: 4;
	-o-tab-size: 4;
	tab-size: 4;

	-webkit-hyphens: none;
	-moz-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
}

/* Code blocks */
pre[class*="language-"] {
	padding: 1em;
	margin: .5em 0;
	overflow: auto;
	border-radius: 0.3em;
}

:not(pre) > code[class*="language-"],
pre[class*="language-"] {
	background: #272822;
}

/* Inline code */
:not(pre) > code[class*="language-"] {
	padding: .1em;
	border-radius: .3em;
	white-space: normal;
}

.token.comment,
.token.prolog,
.token.doctype,
.token.cdata {
	color: #8292a2;
}

.token.punctuation {
	color: #f8f8f2;
}

.token.namespace {
	opacity: .7;
}

.token.property,
.token.tag,
.token.constant,
.token.symbol,
.token.deleted {
	color: #f92672;
}

.token.boolean,
.token.number {
	color: #ae81ff;
}

.token.selector,
.token.attr-name,
.token.string,
.token.char,
.token.builtin,
.token.inserted {
	color: #a6e22e;
}

.token.operator,
.token.entity,
.token.url,
.language-css .token.string,
.style .token.string,
.token.variable {
	color: #f8f8f2;
}

.token.atrule,
.token.attr-value,
.token.function,
.token.class-name {
	color: #e6db74;
}

.token.keyword {
	color: #66d9ef;
}

.token.regex,
.token.important {
	color: #fd971f;
}

.token.important,
.token.bold {
	font-weight: bold;
}
.token.italic {
	font-style: italic;
}

.token.entity {
	cursor: help;
}

/*
 * New diff- syntax
 */

pre[class*="language-diff-"] {
	--eleventy-code-padding: 1.25em;
	padding-left: var(--eleventy-code-padding);
	padding-right: var(--eleventy-code-padding);
}
.token.deleted {
	background-color: hsl(0, 51%, 37%);
	color: inherit;
}
.token.inserted {
	background-color: hsl(126, 31%, 39%);
	color: inherit;
}

/* Make the + and - characters unselectable for copy/paste */
.token.prefix.unchanged,
.token.prefix.inserted,
.token.prefix.deleted {
	-webkit-user-select: none;
	user-select: none;
	display: inline-flex;
	align-items: center;
	justify-content: center;
	padding-top: 2px;
	padding-bottom: 2px;
}
.token.prefix.inserted,
.token.prefix.deleted {
	width: var(--eleventy-code-padding);
	background-color: rgba(0,0,0,.2);
}

/* Optional: full-width background color */
.token.inserted:not(.prefix),
.token.deleted:not(.prefix) {
	display: block;
	margin-left: calc(-1 * var(--eleventy-code-padding));
	margin-right: calc(-1 * var(--eleventy-code-padding));
	text-decoration: none; /* override del, ins, mark defaults */
	color: inherit; /* override del, ins, mark defaults */
}
/* Defaults */
:root {
  --font-family: Menlo, monaco, Consolas, monospace;
	--font-family-monospace: Menlo, Monaco, Consolas, Andale Mono WT, Andale Mono, Lucida Console, Lucida Sans Typewriter, DejaVu Sans Mono, Bitstream Vera Sans Mono, Liberation Mono, Nimbus Mono L, Courier New, Courier, monospace;

  --base-color: #FFEAB4; /* orange yellow crayola: #FFD25A but desat 50% */
  
  --background-color: #191919; /* eerie black */

  --accent-color-1: #FFAA5A; /* Rajah */
  --accent-color-2: #FFF05A; /* corn */
  --accent-color-3: #FF785A; /* outrageous orange */

	--text-color: var(--base-color);
	--text-color-link: var(--accent-color-1);
	--text-color-link-active: var(--accent-color-1);
	--text-color-link-visited: var(--accent-color-1);

	--syntax-tab-size: 2;
}

/* Global stylesheet */
* {
	box-sizing: border-box;
}

html,
body {
	padding: 0;
	margin: 0 auto;
	font-family: var(--font-family);
	color: var(--text-color);
	background-color: var(--background-color);
}
html {
	overflow-y: scroll;
}
body {
	max-width: 40em;
}

/* https://www.a11yproject.com/posts/how-to-hide-content/ */
.visually-hidden {
	clip: rect(0 0 0 0);
	clip-path: inset(50%);
	height: 1px;
	overflow: hidden;
	position: absolute;
	white-space: nowrap;
	width: 1px;
}

p:last-child {
	margin-bottom: 0;
}
p {
	line-height: 1.5;
}

li {
	line-height: 1.5;
}

a[href] {
	color: var(--text-color-link);
}
a[href]:visited {
	color: var(--text-color-link-visited);
}
a[href]:hover,
a[href]:active {
	color: var(--text-color-link-active);
}

main {
	padding: 1rem;
}
main :first-child {
	margin-top: 0;
}

header {
	border-bottom: 1px dashed var(--color-gray-20);
}
header:after {
	content: "";
	display: table;
	clear: both;
}

.links-nextprev {
	list-style: none;
	border-top: 1px dashed var(--color-gray-20);
	padding: 1em 0;
}

table {
	margin: 1em 0;
}
table td,
table th {
	padding-right: 1em;
}

pre,
code {
	font-family: var(--font-family-monospace);
}
pre:not([class*="language-"]) {
	margin: .5em 0;
	line-height: 1.375; /* 22px /16 */
	-moz-tab-size: var(--syntax-tab-size);
	-o-tab-size: var(--syntax-tab-size);
	tab-size: var(--syntax-tab-size);
	-webkit-hyphens: none;
	-ms-hyphens: none;
	hyphens: none;
	direction: ltr;
	text-align: left;
	white-space: pre;
	word-spacing: normal;
	word-break: normal;
}
code {
	word-break: break-all;
}

/* Header */
header {
	display: flex;
	gap: 1em .5em;
	flex-wrap: wrap;
	align-items: center;
	padding: 1em;
}
.home-link {
	font-size: 1em; /* 16px /16 */
	font-weight: 700;
	margin-right: 2em;
}
.home-link:link:not(:hover) {
	text-decoration: none;
}

/* Nav */
.nav {
	display: flex;
	padding: 0;
	margin: 0;
	list-style: none;
}
.nav-item {
	display: inline-block;
	margin-right: 1em;
}
.nav-item a[href]:not(:hover) {
	text-decoration: none;
}
.nav a[href][aria-current="page"] {
	text-decoration: underline;
}

/* Posts list */
.postlist {
	list-style: none;
	padding: 0;
	padding-left: 1.5rem;
}
.postlist-item {
	display: flex;
	flex-wrap: wrap;
	align-items: baseline;
	counter-increment: start-from -1;
	margin-bottom: 1em;
}
.postlist-item:before {
	display: inline-block;
	pointer-events: none;
	content: "" counter(start-from, decimal-leading-zero) ". ";
	line-height: 100%;
	text-align: right;
	margin-left: -1.5rem;
}
.postlist-date,
.postlist-item:before {
	font-size: 0.8125em; /* 13px /16 */
	color: var(--color-gray-90);
}
.postlist-date {
	word-spacing: -0.5px;
}
.postlist-link {
	font-size: 1.1875em; /* 19px /16 */
	font-weight: 700;
	flex-basis: calc(100% - 1.5rem);
	padding-left: .25em;
	padding-right: .5em;
	text-underline-position: from-font;
	text-underline-offset: 0;
	text-decoration-thickness: 1px;
}
.postlist-item-active .postlist-link {
	font-weight: bold;
}

/* Tags */
.post-tag {
	display: inline-flex;
	align-items: center;
	justify-content: center;
	text-transform: capitalize;
	font-style: italic;
}
.postlist-item > .post-tag {
	align-self: center;
}

/* Tags list */
.post-metadata {
	display: inline-flex;
	flex-wrap: wrap;
	gap: .5em;
	list-style: none;
	padding: 0;
	margin: 0;
}
.post-metadata time {
	margin-right: 1em;
}

/* Direct Links / Markdown Headers */
.header-anchor {
	text-decoration: none;
	font-style: normal;
	font-size: 1em;
	margin-left: .1em;
}
a[href].header-anchor,
a[href].header-anchor:visited {
	color: transparent;
}
a[href].header-anchor:focus,
a[href].header-anchor:hover {
	text-decoration: underline;
}
a[href].header-anchor:focus,
:hover > a[href].header-anchor {
	color: #aaa;
}

h2 + .header-anchor {
	font-size: 1.5em;
}

img {
  max-width: 100%;
}</style>
	</head>
	<body>
		<a href="#skip" class="visually-hidden">Skip to main content</a>

		<header>
			<a href="/" class="home-link">Billy Rhoades&#39; Blog</a>
			<nav>
				<h2 class="visually-hidden">Top level navigation menu</h2>
				<ul class="nav">
					<li class="nav-item"><a href="/">Home</a></li>
					<li class="nav-item"><a href="/blog/">Archive</a></li>
				</ul>
			</nav>
		</header>

		<main id="skip">
			
<h1>Creating a Gatling Simulation</h1>

<ul class="post-metadata">
	<li><time datetime="2017-03-21">21 March 2017</time></li>
</ul>

<h1 id="background" tabindex="-1">Background <a class="header-anchor" href="#background">#</a></h1>
<p>I could not find material online that targeted the latest version of Gatling, meant for someone without
a great deal of functional experience. I also don't mean for this to be comprehensive; I just hope
this serves as a starting point to jump off to official documentation.</p>
<h2 id="recommended-reading" tabindex="-1">Recommended Reading <a class="header-anchor" href="#recommended-reading">#</a></h2>
<p><a href="http://blog.jenkster.com/2015/12/what-is-functional-programming.html">What is functional programming</a></p>
<p><a href="https://www.scala-lang.org/documentation/">Scala documentation</a></p>
<p><a href="http://gatling.io/docs/current/">Gatling documentation</a></p>
<h2 id="what-is-gatling" tabindex="-1">What is Gatling <a class="header-anchor" href="#what-is-gatling">#</a></h2>
<p>Gatling is a load testing framework written in Scala. It efficiently simulates HTTP traffic
in a way which allows thousands of concurrent users from a single machine. Gatling does not parse HTML
or run Javascript; if this is your objective you will need to look
<a href="https://github.com/nmeans/phantomherd">elsewhere</a> for that. However, by not rendering HTML,
loading dependencies, or running Javascript, Gatling scales incredibly well.</p>
<p>There are two ways to begin writing a simulation: use the recorder for a basic starting simulation, or
manually write one from scratch. As I did not have the luxury of starting with a recorder,
I cannot discuss how to begin that way. I would imagine, however, that even if you record a simulation,
you will still be editing it. So, most of this post will be covering how to manually write a
Gatling simulation. I've provided a sample Gatling project to help follow along
<a href="https://github.com/brhoades/example-gatling-simulation">here</a>.</p>
<h1 id="recording-a-simulation" tabindex="-1">Recording a Simulation <a class="header-anchor" href="#recording-a-simulation">#</a></h1>
<p>Gatling supports recording simulations using its
<a href="http://gatling.io/docs/current/http/recorder/">HTTP recorder</a>. It acts as a proxy which records
all traffic between a browser and a server and then saves it into a simulation. If the target
website is not https or a custom, self-signed certificate can be used, this method
of creating simulations is ideal. For the website I started load testing,
it wasn't possible to use this recorder, so I am unaware of most of its functionality.</p>
<h1 id="manually-creating-a-simulation" tabindex="-1">Manually Creating a Simulation <a class="header-anchor" href="#manually-creating-a-simulation">#</a></h1>
<p>Structuring a simulation is defined at length <a href="http://gatling.io/docs/current/general/simulation_structure/">here</a>, but a minimal functioning example helps illustrate this:</p>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token keyword">package</span> <span class="token namespace">simpleexample</span><br><br><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>gatling<span class="token punctuation">.</span>core<span class="token punctuation">.</span></span>Predef<span class="token punctuation">.</span>_<br><span class="token keyword">import</span> <span class="token namespace">io<span class="token punctuation">.</span>gatling<span class="token punctuation">.</span>http<span class="token punctuation">.</span></span>Predef<span class="token punctuation">.</span>_<br><br><span class="token keyword">class</span> ExampleSimulation <span class="token keyword">extends</span> Simulation <span class="token punctuation">{</span><br>  <span class="token keyword">val</span> httpConf <span class="token operator">=</span> http<br>    <span class="token punctuation">.</span>baseURL<span class="token punctuation">(</span><span class="token string">"https://google.com"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>acceptHeader<span class="token punctuation">(</span><span class="token string">"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>doNotTrackHeader<span class="token punctuation">(</span><span class="token string">"1"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>acceptLanguageHeader<span class="token punctuation">(</span><span class="token string">"en-US,en;q=0.5"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>acceptEncodingHeader<span class="token punctuation">(</span><span class="token string">"gzip, deflate"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>userAgentHeader<span class="token punctuation">(</span><span class="token string">"Mozilla/5.0 (Windows NT 5.1; rv:31.0) Gecko/20100101 Firefox/31.0"</span><span class="token punctuation">)</span><br><br>  <span class="token keyword">val</span> scn <span class="token operator">=</span> scenario<span class="token punctuation">(</span><span class="token string">"Scenario Name"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>exec<span class="token punctuation">(</span>http<span class="token punctuation">(</span><span class="token string">"Main Page"</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><br>  setUp<span class="token punctuation">(</span>scn<span class="token punctuation">.</span>inject<span class="token punctuation">(</span>atOnceUsers<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>protocols<span class="token punctuation">(</span>httpConf<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token punctuation">}</span></code></pre>
<p>This simulation loads https://google.com/ with the provided HTTP headers with a single user.
The Simulation above describes a single scenario, although there can be many. This scenario
has a single HTTP chain &quot;Main Page&quot;; it visits <code>/</code> relative to the baseURL described in
our <code>httpConf</code>.</p>
<p>The <code>setUp</code> function called at the end of the class definition is what defines the simulation's execution
parameters. In this case, a single user immediately begins the scenario, walking through the single
step of getting <code>/</code>. There are many other options for defining
<a href="http://gatling.io/docs/current/session/feeder/">how user(s) enter the simulation</a> and
<a href="http://gatling.io/docs/current/general/simulation_setup/">at what rate they enter the simulation</a>.</p>
<p>The output of the example simulation above is the following:</p>
<pre><code>Simulation simpleexample.ExampleSimulation started...

================================================================================
2017-03-15 12:47:51                                           2s elapsed
---- Requests ------------------------------------------------------------------
&gt; Global                                                   (OK=2      KO=0     )
&gt; Main Page                                                (OK=1      KO=0     )
&gt; Main Page Redirect 1                                     (OK=1      KO=0     )

---- Scenario Name -------------------------------------------------------------
[##########################################################################]100%
          waiting: 0      / active: 0      / done:1
================================================================================

Simulation simpleexample.ExampleSimulation completed in 0 seconds
Parsing log file(s)...
Parsing log file(s) done
Generating reports...

================================================================================
---- Global Information --------------------------------------------------------
&gt; request count                                          2 (OK=2      KO=0     )
&gt; min response time                                    159 (OK=159    KO=-     )
&gt; max response time                                    477 (OK=477    KO=-     )
&gt; mean response time                                   318 (OK=318    KO=-     )
&gt; std deviation                                        159 (OK=159    KO=-     )
&gt; response time 50th percentile                        318 (OK=318    KO=-     )
&gt; response time 75th percentile                        398 (OK=398    KO=-     )
&gt; response time 95th percentile                        461 (OK=461    KO=-     )
&gt; response time 99th percentile                        474 (OK=474    KO=-     )
&gt; mean requests/sec                                      2 (OK=2      KO=-     )
---- Response Time Distribution ------------------------------------------------
&gt; t &lt; 800 ms                                             2 (100%)
&gt; 800 ms &lt; t &lt; 1200 ms                                   0 (  0%)
&gt; t &gt; 1200 ms                                            0 (  0%)
&gt; failed                                                 0 (  0%)
================================================================================

Reports generated in 0s.
Please open the following file: target/gatling/examplesimulation-1489600069122/index.html
[info] Simulation ExampleSimulation successful.
[info] Simulation(s) execution ended.
[success] Total time: 8 s, completed Mar 15, 2017 12:47:52 PM
</code></pre>
<p>Extended report information can be found in the linked report HTML file. Simulation status
is output while the simulation runs, displaying the number of errors with their details, if
there are any.</p>
<p>It can be seen that when visiting the site's root, a redirect occurred. By default, Gatling
follows all redirects on an HTTP chain and labels them as &quot;Name - Redirect #&quot;. This behavior
can disabled globally, per chain, and capped. More information about redirect configuration
<a href="http://gatling.io/docs/current/http/http_protocol/#follow-redirects">here</a>.</p>
<h2 id="chaining-requests" tabindex="-1">Chaining Requests <a class="header-anchor" href="#chaining-requests">#</a></h2>
<p>In the example simulation above, there was a single request to a single page. For useful simulations,
there will likely be more than one request. As each call to exec returns the modified
scenario object, scenarios can be chained to perform more complex behaviors.</p>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token comment">// ...</span><br>  <span class="token keyword">val</span> scn <span class="token operator">=</span> scenario<span class="token punctuation">(</span><span class="token string">"Scenario Name"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>exec<span class="token punctuation">(</span>http<span class="token punctuation">(</span><span class="token string">"Main Page"</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>exec<span class="token punctuation">(</span>http<span class="token punctuation">(</span><span class="token string">"Search"</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/?q=Some+Query"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token comment">// ...</span></code></pre>
<p>This scenario now also runs a search, visiting https://google.com/?q=Some+Query. Cookies and other
session data are retained and passed between each exec call. Redirects will still be followed at
each step, then continued on the next step. The HTTP protocol supports POST requests,
cookies, redirects, and more complex configurations with proxies. More on this later.</p>
<h2 id="assertions" tabindex="-1">Assertions <a class="header-anchor" href="#assertions">#</a></h2>
<p>Assertions can be used to verify that responses contain expected content. One of the most basic
assertions is for status codes. For example, if we we wanted our scenario to verify that
the Google main page returned HTTP200:</p>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token comment">// ...</span><br>  <span class="token keyword">val</span> scn <span class="token operator">=</span> scenario<span class="token punctuation">(</span><span class="token string">"Scenario Name"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>exec<span class="token punctuation">(</span>http<span class="token punctuation">(</span><span class="token string">"Main Page"</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>check<span class="token punctuation">(</span>status<span class="token punctuation">.</span>is<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>exec<span class="token punctuation">(</span>http<span class="token punctuation">(</span><span class="token string">"Search"</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/?q=Some+Query"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token comment">// ...</span></code></pre>
<p>If there was not an HTTP200, the scenario would print the name of the request, <code>'Main Page'</code>, and state
the expected and found status codes. This would count as a KO in the statistics output as well:</p>
<pre><code>...
&gt; Global                                                   (OK=1      KO=1     )
&gt; Main Page                                                (OK=0      KO=1     )
&gt; Search                                                   (OK=1      KO=0     )
...
</code></pre>
<p>Which signifies that this particular request failed to pass validation. <strong>Note that the simulation
continues</strong> even though there was a failure at a prior step. There are
<a href="http://gatling.io/docs/current/general/scenario/#exithereiffailed">methods which work around this</a>,
which can be useful when authentication fails.</p>
<p>CSS selectors are also used to verify content on pages. For example, if we wanted to ensure
that the main page had an <code>html</code> node with the attribute <code>size</code> set to <code>mobile</code>:</p>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token comment">// ...</span><br>  <span class="token keyword">val</span> scn <span class="token operator">=</span> scenario<span class="token punctuation">(</span><span class="token string">"Scenario Name"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>exec<span class="token punctuation">(</span>http<span class="token punctuation">(</span><span class="token string">"Main Page"</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>check<span class="token punctuation">(</span>status<span class="token punctuation">.</span>is<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>check<span class="token punctuation">(</span>css<span class="token punctuation">(</span><span class="token string">"html[size]"</span><span class="token punctuation">,</span> <span class="token string">"mobile"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>exists<span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token comment">// ...</span></code></pre>
<p>A great deal of other assertions exist for optionality, performance, header values,
performance requirements, etc. More details are available
<a href="http://gatling.io/docs/current/general/assertions/">here</a>.</p>
<h2 id="session-modification-and-inspection" tabindex="-1">Session Modification and Inspection <a class="header-anchor" href="#session-modification-and-inspection">#</a></h2>
<p>Sessions are implicitly passed between each exec call. They can manually inspected or modified
during scenario definition by executing a custom function with exec.</p>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token comment">// ...</span><br>  <span class="token keyword">val</span> scn <span class="token operator">=</span> scenario<span class="token punctuation">(</span><span class="token string">"Scenario Name"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>exec<span class="token punctuation">(</span>http<span class="token punctuation">(</span><span class="token string">"Main Page"</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>exec<span class="token punctuation">(</span>session <span class="token keyword">=></span> <span class="token punctuation">{</span><br>      println<span class="token punctuation">(</span>session<span class="token punctuation">)</span><br>      session<br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>exec<span class="token punctuation">(</span>session <span class="token keyword">=></span> session<span class="token punctuation">.</span>set<span class="token punctuation">(</span><span class="token string">"hello"</span><span class="token punctuation">,</span> <span class="token string">"bla"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>exec<span class="token punctuation">(</span>session <span class="token keyword">=></span> <span class="token punctuation">{</span><br>      println<span class="token punctuation">(</span>session<span class="token punctuation">)</span><br>      session<br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br><span class="token comment">// ...</span></code></pre>
<p>Above is the same scenario as our first one. However, this scenario prints the session,
sets &quot;hello&quot; in the session to &quot;bla&quot;, then prints it again. <em>Note: if you are not sure why
session is being repeated after printing it, try to only print it and see what happens.</em></p>
<p>Here is the output:</p>
<pre class="language-scala" tabindex="0"><code class="language-scala">Simulation simpleexample<span class="token punctuation">.</span>ExampleSimulation started<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><br>Session<span class="token punctuation">(</span>Scenario Name<span class="token punctuation">,</span><br><span class="token number">1</span><span class="token punctuation">,</span><br>Map<span class="token punctuation">(</span><br>  gatling<span class="token punctuation">.</span>http<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>dns <span class="token operator">-></span> io<span class="token punctuation">.</span>gatling<span class="token punctuation">.</span>http<span class="token punctuation">.</span>resolver<span class="token punctuation">.</span>ShuffleJdkNameResolver<span class="token annotation punctuation">@582701e2</span><span class="token punctuation">,</span><br>  gatling<span class="token punctuation">.</span>http<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>redirects <span class="token operator">-></span> io<span class="token punctuation">.</span>gatling<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>Cache<span class="token annotation punctuation">@2c5ead52</span><span class="token punctuation">,</span><br>  gatling<span class="token punctuation">.</span>http<span class="token punctuation">.</span>cookies <span class="token operator">-></span> CookieJar<span class="token punctuation">(</span><br>  Map<span class="token punctuation">(</span><br>    CookieKey<span class="token punctuation">(</span>nid<span class="token punctuation">,</span>google<span class="token punctuation">.</span>com<span class="token punctuation">,</span><span class="token operator">/</span><span class="token punctuation">)</span> <span class="token operator">-></span> StoredCookie<span class="token punctuation">(</span>NID<span class="token operator">=</span><span class="token number">99</span><span class="token operator">=</span>SkqwEzuPt4c2J<span class="token operator">-</span>cwZMPjX0rPxHeZHWTiDaeyEvQr<span class="token operator">-</span><span class="token number">82D</span>h0NlSie_<span class="token operator">-</span>trLh9SO9OfYVed4nShyQv0wFIWUnyCDsshfjsEgE0M5eYT_W3Hn2Jm20vxV56nyq4q7uRvM96bP8qnL_HPAfiMH2fXb4w<span class="token punctuation">;</span> domain<span class="token operator">=</span><span class="token punctuation">.</span>google<span class="token punctuation">.</span>com<span class="token punctuation">;</span> path<span class="token operator">=</span><span class="token operator">/</span><span class="token punctuation">;</span> HTTPOnly<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token number">1489611434846</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  gatling<span class="token punctuation">.</span>http<span class="token punctuation">.</span>referer <span class="token operator">-></span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>google<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token number">1489611433728</span><span class="token punctuation">,</span><br>  <span class="token number">42</span><span class="token punctuation">,</span><br>  OK<span class="token punctuation">,</span><br>  List<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  io<span class="token punctuation">.</span>gatling<span class="token punctuation">.</span>core<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>ProtocolComponentsRegistry$$Lambda$<span class="token number">149</span><span class="token operator">/</span><span class="token number">418118518</span><span class="token annotation punctuation">@c4d1ae6</span><span class="token punctuation">)</span><br><br>Session<span class="token punctuation">(</span>Scenario Name<span class="token punctuation">,</span><br>  <span class="token number">1</span><span class="token punctuation">,</span><br>  Map<span class="token punctuation">(</span><br>    gatling<span class="token punctuation">.</span>http<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>dns <span class="token operator">-></span> io<span class="token punctuation">.</span>gatling<span class="token punctuation">.</span>http<span class="token punctuation">.</span>resolver<span class="token punctuation">.</span>ShuffleJdkNameResolver<span class="token annotation punctuation">@582701e2</span><span class="token punctuation">,</span><br>    gatling<span class="token punctuation">.</span>http<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>redirects <span class="token operator">-></span> io<span class="token punctuation">.</span>gatling<span class="token punctuation">.</span>core<span class="token punctuation">.</span>util<span class="token punctuation">.</span>cache<span class="token punctuation">.</span>Cache<span class="token annotation punctuation">@2c5ead52</span><span class="token punctuation">,</span><br>    gatling<span class="token punctuation">.</span>http<span class="token punctuation">.</span>cookies <span class="token operator">-></span> CookieJar<span class="token punctuation">(</span>Map<span class="token punctuation">(</span><br>      CookieKey<span class="token punctuation">(</span>nid<span class="token punctuation">,</span>google<span class="token punctuation">.</span>com<span class="token punctuation">,</span><span class="token operator">/</span><span class="token punctuation">)</span> <span class="token operator">-></span> StoredCookie<span class="token punctuation">(</span>NID<span class="token operator">=</span><span class="token number">99</span><span class="token operator">=</span>SkqwEzuPt4c2J<span class="token operator">-</span>cwZMPjX0rPxHeZHWTiDaeyEvQr<span class="token operator">-</span><span class="token number">82D</span>h0NlSie_<span class="token operator">-</span>trLh9SO9OfYVed4nShyQv0wFIWUnyCDsshfjsEgE0M5eYT_W3Hn2Jm20vxV56nyq4q7uRvM96bP8qnL_HPAfiMH2fXb4w<span class="token punctuation">;</span> domain<span class="token operator">=</span><span class="token punctuation">.</span>google<span class="token punctuation">.</span>com<span class="token punctuation">;</span> path<span class="token operator">=</span><span class="token operator">/</span><span class="token punctuation">;</span> HTTPOnly<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">,</span><span class="token number">1489611434846</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  gatling<span class="token punctuation">.</span>http<span class="token punctuation">.</span>referer <span class="token operator">-></span> https<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>www<span class="token punctuation">.</span>google<span class="token punctuation">.</span>com<span class="token operator">/</span><span class="token punctuation">,</span><br>  <span class="token string">"hello"</span> <span class="token operator">-></span> <span class="token string">"bla"</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  <span class="token number">1489611433728</span><span class="token punctuation">,</span><br>  <span class="token number">42</span><span class="token punctuation">,</span><br>  OK<span class="token punctuation">,</span><br>  List<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><br>  io<span class="token punctuation">.</span>gatling<span class="token punctuation">.</span>core<span class="token punctuation">.</span>protocol<span class="token punctuation">.</span>ProtocolComponentsRegistry$$Lambda$<span class="token number">149</span><span class="token operator">/</span><span class="token number">418118518</span><span class="token annotation punctuation">@c4d1ae6</span><span class="token punctuation">)</span></code></pre>
<p>In between the first and second session output, I set &quot;hello&quot; to &quot;bla&quot; which can be see in the second session.
This is the primary mechanism to inspect and modify the session from the level of scenario definition.</p>
<h2 id="post-requests-and-session-access" tabindex="-1">POST Requests and Session Access <a class="header-anchor" href="#post-requests-and-session-access">#</a></h2>
<p>POST requests typically make use of the
<a href="http://gatling.io/docs/current/http/http_check/#http-check-saving">saveAs</a>
assertion in order to retain response details from a previous server response. However, this doesn't
always have to be the case. Here's a contrived simulation below for the sake of an easy example:</p>
<pre class="language-scala" tabindex="0"><code class="language-scala"><span class="token comment">// ...</span><br>  <span class="token keyword">val</span> scn <span class="token operator">=</span> scenario<span class="token punctuation">(</span><span class="token string">"Scenario Name"</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>exec<span class="token punctuation">(</span>http<span class="token punctuation">(</span><span class="token string">"Login Form"</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token string">"/login"</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span>check<span class="token punctuation">(</span>status<span class="token punctuation">.</span>is<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span>check<span class="token punctuation">(</span>css<span class="token punctuation">(</span><span class="token string">"form[action]"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>saveAs<span class="token punctuation">(</span><span class="token string">"form_action"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span>check<span class="token punctuation">(</span>css<span class="token punctuation">(</span><span class="token string">"input[name='csrf_token']"</span><span class="token punctuation">,</span> <span class="token string">"value"</span><span class="token punctuation">)</span><span class="token punctuation">.</span>saveAs<span class="token punctuation">(</span><span class="token string">"csrf_token"</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span>exec<span class="token punctuation">(</span>http<span class="token punctuation">(</span><span class="token string">"Login (POST)"</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>post<span class="token punctuation">(</span><span class="token string">"${form_action}"</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span>formParam<span class="token punctuation">(</span><span class="token string">"csrf_token"</span><span class="token punctuation">,</span> <span class="token string">"${csrf_token}"</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span>formParam<span class="token punctuation">(</span><span class="token string">"login_username"</span><span class="token punctuation">,</span> <span class="token string">"someuser"</span><span class="token punctuation">)</span><br>        <span class="token punctuation">.</span>formParam<span class="token punctuation">(</span><span class="token string">"login_password"</span><span class="token punctuation">,</span> <span class="token string">"somepassword"</span><span class="token punctuation">)</span><br>      <span class="token punctuation">.</span>check<span class="token punctuation">(</span>status<span class="token punctuation">.</span>is<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><br><span class="token comment">// ...</span></code></pre>
<p>A few new things here; let's begin with the <code>post</code> HTTP chain method. This method behaves similarly
to <code>get</code>, but typically uses some sort of input. There are
<a href="http://gatling.io/docs/current/http/http_request/#form-parameters">other methods</a> which allow the use
of <code>Map</code>s, but here we will manually build our request data using <code>formParam</code>. These parameters are
sent to the url specified in the <code>post</code> method's first argument as a response using the keys and
values specified.</p>
<p>In this example the form's action value was captured and saved into &quot;form_action&quot; on the session.
The next POST request then read from the session using a bash-like syntax, <code>${keyname}</code>. This reads
the key from the session <code>Map</code> directly, and will print warning if it's not found. Once the POST is complete,
the status will be checked to verify the server responded with HTTP200.</p>
<p>Further information about the HTTP protocol is also available on the
<a href="http://gatling.io/docs/current/http/">official documentation page</a>. Information regarding the session
object be found <a href="http://gatling.io/docs/current/session/session_api/">here</a>.</p>
<h2 id="distribution" tabindex="-1">Distribution <a class="header-anchor" href="#distribution">#</a></h2>
<p>Gatling plugins exist for both <a href="http://gatling.io/docs/current/extensions/sbt_plugin/">sbt</a> and
<a href="https://github.com/lkishalmi/gradle-gatling-plugin">Gradle</a>. Both work very well, however the sbt
plugin is an official extension to Gatling and contains the most comprehensive documentation and examples.
Unless Gatling is being added to an existing Gradle project, I would highly recommend using the sbt
extension. As the <a href="http://gatling.io/docs/current/extensions/sbt_plugin/">official documentation</a> does
not explicitly state this, here is a minimal collection of files to get an sbt project running:</p>
<p>Your project tree, for a standalone sbt project, should look similar to this:</p>
<pre><code>├── build.sbt
├── project
│   ├── build.properties
│   └── plugins.sbt
└── src
    └── test
        ├── resources
        └── scala
            └── simpleexample
                └── ExampleSimulation.scala
</code></pre>
<p>build.sbt</p>
<pre><code>enablePlugins(GatlingPlugin)

scalaVersion := &quot;2.11.8&quot;

scalacOptions := Seq(
  &quot;-encoding&quot;, &quot;UTF-8&quot;, &quot;-target:jvm-1.8&quot;, &quot;-deprecation&quot;,
  &quot;-feature&quot;, &quot;-unchecked&quot;, &quot;-language:implicitConversions&quot;, &quot;-language:postfixOps&quot;)

libraryDependencies += &quot;io.gatling.highcharts&quot; % &quot;gatling-charts-highcharts&quot; % &quot;2.2.4&quot; % &quot;test,it&quot;
libraryDependencies += &quot;io.gatling&quot;            % &quot;gatling-test-framework&quot;    % &quot;2.2.4&quot; % &quot;test,it&quot;

addCompilerPlugin(&quot;org.psywerx.hairyfotr&quot; %% &quot;linter&quot; % &quot;0.1.17&quot;)
</code></pre>
<p>project/build.properties</p>
<pre><code>sbt.version=0.13.13
</code></pre>
<p>project/plugins.sbt</p>
<pre><code>addSbtPlugin(&quot;io.gatling&quot; % &quot;gatling-sbt&quot; % &quot;2.2.1&quot;)
</code></pre>
<p>Once the above files are set up, install sbt and run:</p>
<pre class="language-bash" tabindex="0"><code class="language-bash">$ sbt</code></pre>
<p>Then simulations may be run either from the sbt shell:</p>
<pre><code>$ sbt
&gt; gatling:testOnly somepackage.GeneralBrowse
</code></pre>
<p>Or, instead, from your shell:</p>
<pre><code>$ sbt &quot;gatling:testOnly somepackage.GeneralBrowse&quot;
</code></pre>
<p>The reports can be found in <code>/target/gatling/</code> and the last report can be opened in a web browser
with:</p>
<pre><code>$ sbt gatling:lastReport
</code></pre>
<p>A list of all sbt tasks are available <a href="http://gatling.io/docs/current/extensions/sbt_plugin/">here</a>.</p>
<h1 id="reference-material" tabindex="-1">Reference Material <a class="header-anchor" href="#reference-material">#</a></h1>
<p><a href="http://gatling.io/docs/current/cheat-sheet/">Gatling cheat sheet</a></p>

<ul class="links-nextprev"><li>Previous: <a href="/posts/2017-02-20-my-first-markov-chain-bot/">Markov Chain Speech Generation Part 1: Background</a></li><li>Next: <a href="/posts/2018-07-06-react-pitfalls/">React Pitfalls</a></li>
</ul>

		</main>

		<footer></footer>

		<!-- Current page: /posts/2017-03-21-creating-a-simple-gatling-simulation/ -->
	</body>
</html>
